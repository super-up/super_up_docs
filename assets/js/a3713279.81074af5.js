"use strict";(globalThis.webpackChunksuper_up_docs=globalThis.webpackChunksuper_up_docs||[]).push([[588],{8165:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>t,metadata:()=>s,toc:()=>i});var a=r(4320),o=(r(7953),r(8860));const t={sidebar_position:4},l="Deployment (VPS)",s={unversionedId:"deployment",id:"deployment",title:"Deployment (VPS)",description:"This is a complete, production-focused deployment guide for your own VPS. Includes both non-Docker and Docker Compose paths, Nginx reverse proxy, WebSocket config, and free SSL.",source:"@site/docs/deployment.md",sourceDirName:".",slug:"/deployment",permalink:"/super_up_docs/docs/deployment",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"defaultSidebar",previous:{title:"Backend (Nodejs)",permalink:"/super_up_docs/docs/backend"},next:{title:"Get Support",permalink:"/super_up_docs/docs/support"}},p={},i=[{value:"Plan your domains",id:"plan-your-domains",level:2},{value:"Non\u2011Docker deployment (Ubuntu 22.04/24.04)",id:"nondocker-deployment-ubuntu-22042404",level:2},{value:"1) System packages",id:"1-system-packages",level:3},{value:"2) Install MongoDB 6.0",id:"2-install-mongodb-60",level:3},{value:"3) Install Node.js (recommended latest LTS/Current) + PM2",id:"3-install-nodejs-recommended-latest-ltscurrent--pm2",level:3},{value:"4) Backend setup (NestJS API)",id:"4-backend-setup-nestjs-api",level:3},{value:"5) Nginx reverse proxy (with WebSocket support)",id:"5-nginx-reverse-proxy-with-websocket-support",level:3},{value:"6) Free SSL (Let\u2019s Encrypt)",id:"6-free-ssl-lets-encrypt",level:3},{value:"7) Firewall",id:"7-firewall",level:3},{value:"8) Deploy Flutter web + Admin builds",id:"8-deploy-flutter-web--admin-builds",level:3},{value:"Docker Compose deployment",id:"docker-compose-deployment",level:2},{value:"Configure Flutter apps for your domain",id:"configure-flutter-apps-for-your-domain",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}],d={toc:i},u="wrapper";function c({components:e,...n}){return(0,o.yg)(u,(0,a.A)({},d,n,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"deployment-vps"},"Deployment (VPS)"),(0,o.yg)("p",null,"This is a complete, production-focused deployment guide for your own VPS. Includes both non-Docker and Docker Compose paths, Nginx reverse proxy, WebSocket config, and free SSL."),(0,o.yg)("h2",{id:"plan-your-domains"},"Plan your domains"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"api subdomain (backend REST + WebSockets): ",(0,o.yg)("inlineCode",{parentName:"li"},"api.example.com")),(0,o.yg)("li",{parentName:"ul"},"web app (Flutter web build): ",(0,o.yg)("inlineCode",{parentName:"li"},"web.example.com")),(0,o.yg)("li",{parentName:"ul"},"admin panel (Flutter web build): ",(0,o.yg)("inlineCode",{parentName:"li"},"admin.example.com"))),(0,o.yg)("p",null,"Point DNS A records of these subdomains to your VPS public IP."),(0,o.yg)("h2",{id:"nondocker-deployment-ubuntu-22042404"},"Non\u2011Docker deployment (Ubuntu 22.04/24.04)"),(0,o.yg)("h3",{id:"1-system-packages"},"1) System packages"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"sudo apt update && sudo apt -y upgrade\nsudo apt -y install nginx ufw git curl build-essential\n")),(0,o.yg)("h3",{id:"2-install-mongodb-60"},"2) Install MongoDB 6.0"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'curl -fsSL https://pgp.mongodb.com/server-6.0.asc | sudo gpg -o /usr/share/keyrings/mongodb-server-6.0.gpg --dearmor\necho "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu $(. /etc/os-release && echo $UBUNTU_CODENAME)/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list\nsudo apt update\nsudo apt -y install mongodb-org\nsudo systemctl enable --now mongod\n')),(0,o.yg)("p",null,"Create users:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'mongosh <<\'EOF\'\nuse admin\ndb.createUser({user: "root", pwd: "CHANGE-ME-STRONG", roles: ["root"]})\nuse super_up\ndb.createUser({user: "appuser", pwd: "CHANGE-ME-STRONG", roles: [{role: "readWrite", db: "super_up"}]})\nEOF\n')),(0,o.yg)("h3",{id:"3-install-nodejs-recommended-latest-ltscurrent--pm2"},"3) Install Node.js (recommended latest LTS/Current) + PM2"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"curl -fsSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash\nsource ~/.nvm/nvm.sh\nnvm install 23\nnode -v\nnpm i -g pm2@latest\n")),(0,o.yg)("h3",{id:"4-backend-setup-nestjs-api"},"4) Backend setup (NestJS API)"),(0,o.yg)("p",null,"Assume your backend lives at ",(0,o.yg)("inlineCode",{parentName:"p"},"/var/www/super-up/backend"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir -p /var/www/super-up/backend\nsudo chown -R $USER:$USER /var/www/super-up\ncd /var/www/super-up/backend\n")),(0,o.yg)("p",null,"Create ",(0,o.yg)("inlineCode",{parentName:"p"},".env.production")," (adjust to your values):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-env"},"DB_URL=mongodb://appuser:CHANGE-ME-STRONG@127.0.0.1:27017/super_up?authSource=super_up\nJWT_SECRET=CHANGE-ME-STRONG\nissuer=you@example.com\naudience=you@example.com\nNODE_ENV=production\nEDIT_MODE=false\nignoreEnvFile=false\nPORT=3000\nControlPanelAdminPassword=CHANGE-ME-ADMIN\nControlPanelAdminPasswordViewer=CHANGE-ME-VIEWER\nisOneSignalEnabled=false\nisFirebaseFcmEnabled=false\nEMAIL_HOST=\nEMAIL_USER=\nEMAIL_PASSWORD=\nAGORA_APP_ID=\nAGORA_APP_CERTIFICATE=\n")),(0,o.yg)("p",null,"Install, build, and run with PM2 cluster mode:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"npm ci\nnpm run build\n\n# Minimal PM2 ecosystem file (create ecosystem.config.js)\ncat > ecosystem.config.js <<'JS'\nmodule.exports = {\n  apps: [\n    {\n      name: 'super-up-api',\n      script: 'dist/main.js',\n      cwd: '/var/www/super-up/backend',\n      instances: 'max',\n      exec_mode: 'cluster',\n      env_production: { NODE_ENV: 'production', PORT: 3000 }\n    }\n  ]\n}\nJS\n\npm2 start ecosystem.config.js --env production\npm2 save\npm2 startup systemd -u $USER --hp $HOME\n")),(0,o.yg)("h3",{id:"5-nginx-reverse-proxy-with-websocket-support"},"5) Nginx reverse proxy (with WebSocket support)"),(0,o.yg)("p",null,"API ",(0,o.yg)("inlineCode",{parentName:"p"},"api.example.com")," \u2192 Node.js at ",(0,o.yg)("inlineCode",{parentName:"p"},"127.0.0.1:3000"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-nginx"},'server {\n  listen 80;\n  server_name api.example.com;\n\n  location / {\n    proxy_pass http://127.0.0.1:3000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n  }\n}\n')),(0,o.yg)("p",null,"Flutter web (SPA) ",(0,o.yg)("inlineCode",{parentName:"p"},"web.example.com")," serving built files at ",(0,o.yg)("inlineCode",{parentName:"p"},"/var/www/super-up/web"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-nginx"},"server {\n  listen 80;\n  server_name web.example.com;\n  root /var/www/super-up/web;\n  index index.html;\n\n  location / {\n    try_files $uri /index.html;\n  }\n}\n")),(0,o.yg)("p",null,"Admin panel ",(0,o.yg)("inlineCode",{parentName:"p"},"admin.example.com")," serving ",(0,o.yg)("inlineCode",{parentName:"p"},"/var/www/super-up/admin")," similarly."),(0,o.yg)("p",null,"Enable sites and reload Nginx:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir -p /etc/nginx/sites-available /etc/nginx/sites-enabled\nsudo tee /etc/nginx/sites-available/api.example.com >/dev/null < api.conf\nsudo tee /etc/nginx/sites-available/web.example.com >/dev/null < web.conf\nsudo ln -s /etc/nginx/sites-available/api.example.com /etc/nginx/sites-enabled/\nsudo ln -s /etc/nginx/sites-available/web.example.com /etc/nginx/sites-enabled/\nsudo nginx -t && sudo systemctl reload nginx\n")),(0,o.yg)("h3",{id:"6-free-ssl-lets-encrypt"},"6) Free SSL (Let\u2019s Encrypt)"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"sudo snap install core && sudo snap refresh core\nsudo snap install --classic certbot\nsudo ln -s /snap/bin/certbot /usr/bin/certbot\nsudo certbot --nginx -d api.example.com -d web.example.com -d admin.example.com --redirect -m you@example.com --agree-tos -n\n")),(0,o.yg)("h3",{id:"7-firewall"},"7) Firewall"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow OpenSSH\nsudo ufw allow 'Nginx Full'\nsudo ufw --force enable\n")),(0,o.yg)("h3",{id:"8-deploy-flutter-web--admin-builds"},"8) Deploy Flutter web + Admin builds"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Build web inside your Flutter apps:")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd super_up_app\nflutter build web --release --web-renderer html\nsudo rsync -a build/web/ /var/www/super-up/web/\n\ncd ../super_up_admin\nflutter build web --release --web-renderer html\nsudo rsync -a build/web/ /var/www/super-up/admin/\n")),(0,o.yg)("h2",{id:"docker-compose-deployment"},"Docker Compose deployment"),(0,o.yg)("p",null,"Directory layout (example):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"/opt/super-up/\n  backend/            # your NestJS backend project (has Dockerfile)\n  docker-compose.yml\n  .env\n  mongo-init.js\n  media/              # persistent uploads/media\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},".env")," (used by compose):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-env"},"DB_URL=mongodb://appuser:CHANGE-ME-STRONG@mongo:27017/super_up?authSource=admin\nJWT_SECRET=CHANGE-ME-STRONG\nNODE_ENV=production\nPORT=3000\nControlPanelAdminPassword=CHANGE-ME-ADMIN\nControlPanelAdminPasswordViewer=CHANGE-ME-VIEWER\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"mongo-init.js")," (creates app DB user):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'db = db.getSiblingDB("super_up");\ndb.createUser({\n  user: "appuser",\n  pwd: "CHANGE-ME-STRONG",\n  roles: [{ role: "readWrite", db: "super_up" }],\n});\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"docker-compose.yml"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},'version: "3.9"\nservices:\n  mongo:\n    image: mongo:6\n    restart: unless-stopped\n    volumes:\n      - mongo_data:/data/db\n      - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro\n    ports:\n      - "127.0.0.1:27017:27017"\n\n  api:\n    build:\n      context: ./backend\n    environment:\n      DB_URL: ${DB_URL}\n      JWT_SECRET: ${JWT_SECRET}\n      NODE_ENV: ${NODE_ENV}\n      PORT: ${PORT}\n      ControlPanelAdminPassword: ${ControlPanelAdminPassword}\n      ControlPanelAdminPasswordViewer: ${ControlPanelAdminPasswordViewer}\n    volumes:\n      - ./media:/app/public/uploads\n    depends_on:\n      - mongo\n    restart: unless-stopped\n    ports:\n      - "127.0.0.1:8080:3000" # expose API on 8080 locally\n\nvolumes:\n  mongo_data:\n')),(0,o.yg)("p",null,"Up the stack:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd /opt/super-up\ndocker compose up -d --build\ndocker compose logs -f api | cat\n")),(0,o.yg)("p",null,"Configure Nginx ",(0,o.yg)("inlineCode",{parentName:"p"},"api.example.com")," to reverse proxy to ",(0,o.yg)("inlineCode",{parentName:"p"},"http://127.0.0.1:8080")," with the same WebSocket headers shown earlier. SSL with Certbot is identical to non-Docker."),(0,o.yg)("h2",{id:"configure-flutter-apps-for-your-domain"},"Configure Flutter apps for your domain"),(0,o.yg)("p",null,"Inside ",(0,o.yg)("inlineCode",{parentName:"p"},"SConstants")," in Flutter set your production domain; example:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-dart"},'static const _productionBaseUrl = "example.com"; // not including protocol\n// Media and API builders already prefix with https://api.\n')),(0,o.yg)("p",null,"Ensure the backend is reachable at ",(0,o.yg)("inlineCode",{parentName:"p"},"https://api.example.com")," and CORS is allowed if enforced."),(0,o.yg)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"WebSocket 400/upgrade errors: ensure Nginx has ",(0,o.yg)("inlineCode",{parentName:"li"},"Upgrade"),"/",(0,o.yg)("inlineCode",{parentName:"li"},"Connection upgrade")," headers and ",(0,o.yg)("inlineCode",{parentName:"li"},"proxy_http_version 1.1"),"."),(0,o.yg)("li",{parentName:"ul"},"502 Bad Gateway: API not listening, wrong upstream port, or PM2/app crashed. Check ",(0,o.yg)("inlineCode",{parentName:"li"},"pm2 logs")," or ",(0,o.yg)("inlineCode",{parentName:"li"},"docker compose logs"),"."),(0,o.yg)("li",{parentName:"ul"},"Firebase/OneSignal push not working: verify keys on backend ",(0,o.yg)("inlineCode",{parentName:"li"},".env")," and Flutter ",(0,o.yg)("inlineCode",{parentName:"li"},"SConstants"),", and platform-specific setup in Flutter doc."),(0,o.yg)("li",{parentName:"ul"},"Mongo auth failed: double-check ",(0,o.yg)("inlineCode",{parentName:"li"},"DB_URL"),", authSource, and that user exists in the correct DB.")))}c.isMDXComponent=!0},8860:(e,n,r)=>{r.d(n,{xA:()=>d,yg:()=>g});var a=r(7953);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,a)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach(function(n){o(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s(e,n){if(null==e)return{};var r,a,o=function(e,n){if(null==e)return{};var r,a,o={},t=Object.keys(e);for(a=0;a<t.length;a++)r=t[a],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(a=0;a<t.length;a++)r=t[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var p=a.createContext({}),i=function(e){var n=a.useContext(p),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},d=function(e){var n=i(e.components);return a.createElement(p.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef(function(e,n){var r=e.components,o=e.mdxType,t=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=i(r),m=o,g=u["".concat(p,".").concat(m)]||u[m]||c[m]||t;return r?a.createElement(g,l(l({ref:n},d),{},{components:r})):a.createElement(g,l({ref:n},d))});function g(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var t=r.length,l=new Array(t);l[0]=m;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s[u]="string"==typeof e?e:o,l[1]=s;for(var i=2;i<t;i++)l[i]=r[i];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"}}]);