"use strict";(globalThis.webpackChunksuper_up_docs=globalThis.webpackChunksuper_up_docs||[]).push([[550],{5516:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>y});var t=a(4320),r=(a(7953),a(8860));const o={sidebar_position:3},i="Backend (Nodejs)",l={unversionedId:"backend",id:"backend",title:"Backend (Nodejs)",description:"---",source:"@site/docs/backend.md",sourceDirName:".",slug:"/backend",permalink:"/super_up_docs/docs/backend",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"defaultSidebar",previous:{title:"Flutter",permalink:"/super_up_docs/docs/flutter"},next:{title:"Deployment (VPS)",permalink:"/super_up_docs/docs/deployment"}},p={},y=[{value:"Requirements",id:"requirements",level:3},{value:".env file",id:"env-file",level:3},{value:"Privacy policy",id:"privacy-policy",level:3},{value:"Firebase admin file",id:"firebase-admin-file",level:3},{value:"Setting up Agora (calls)",id:"setting-up-agora-calls",level:3},{value:"Obtaining OneSignal keys",id:"obtaining-onesignal-keys",level:3},{value:"Running the code (without Docker)",id:"running-the-code-without-docker",level:3},{value:"Deploy web",id:"deploy-web",level:3},{value:"Deploy admin",id:"deploy-admin",level:3},{value:"Running the code (with Docker)",id:"running-the-code-with-docker",level:3},{value:"Running the code (with PM2)",id:"running-the-code-with-pm2",level:3},{value:"AuthKey.p8",id:"authkeyp8",level:3},{value:"Common errors",id:"common-errors",level:3}],g={toc:y},u="wrapper";function d({components:e,...n}){return(0,r.yg)(u,(0,t.A)({},g,n,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"backend-nodejs"},"Backend (Nodejs)"),(0,r.yg)("hr",null),(0,r.yg)("h3",{id:"requirements"},"Requirements"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Experience with Ubuntu server deployment is recommended (or contact ",(0,r.yg)("a",{parentName:"p",href:"mailto:hatemragapdev@gmail.com"},"me"),").")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Install Node.js (current recommended: ",(0,r.yg)("inlineCode",{parentName:"p"},"v23.x"),") and npm. Check with ",(0,r.yg)("inlineCode",{parentName:"p"},"node -v"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If not using Docker: install ",(0,r.yg)("inlineCode",{parentName:"p"},"pm2")," (",(0,r.yg)("inlineCode",{parentName:"p"},"npm i -g pm2"),") and ",(0,r.yg)("inlineCode",{parentName:"p"},"@nestjs/cli")," (",(0,r.yg)("inlineCode",{parentName:"p"},"npm i -g @nestjs/cli"),").")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Install ",(0,r.yg)("a",{parentName:"p",href:"https://www.mongodb.com/try/download/community"},"MongoDB")," (minimum ",(0,r.yg)("inlineCode",{parentName:"p"},"v5"),", recommended ",(0,r.yg)("inlineCode",{parentName:"p"},"v6"),")."))),(0,r.yg)("h3",{id:"env-file"},".env file"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'# Mongo connection (local, Docker, or remote)\nDB_URL="mongodb://127.0.0.1:27017/super_up"\n\n# Security (do not change after launch)\nJWT_SECRET="CHANGE-ME-STRONG"\nissuer="you@example.com"\naudience="you@example.com"\n\n# Runtime\nNODE_ENV="production"\nEDIT_MODE="false"\nignoreEnvFile="false"  # set true if injecting via OS env\nPORT=3000\n\n# Admin panel passwords\nControlPanelAdminPassword="CHANGE-ME-ADMIN"\nControlPanelAdminPasswordViewer="CHANGE-ME-VIEWER"\n\n# Push providers\nisOneSignalEnabled="false"\nisFirebaseFcmEnabled="false"\noneSignalAppId=""\noneSignalApiKey=""\n\n# Email (OTP)\nEMAIL_HOST=""\nEMAIL_USER=""\nEMAIL_PASSWORD=""\n\n# Agora (calls)\nAGORA_APP_ID=""\nAGORA_APP_CERTIFICATE=""\n')),(0,r.yg)("h3",{id:"privacy-policy"},"Privacy policy"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Update the privacy policy HTML at ",(0,r.yg)("inlineCode",{parentName:"li"},"public/privacy-policy.html")," (served at ",(0,r.yg)("inlineCode",{parentName:"li"},"/privacy-policy.html"),")."),(0,r.yg)("li",{parentName:"ul"},"Update the landing HTML at ",(0,r.yg)("inlineCode",{parentName:"li"},"public/home.html")," (served at ",(0,r.yg)("inlineCode",{parentName:"li"},"/"),").")),(0,r.yg)("h3",{id:"firebase-admin-file"},"Firebase admin file"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Make sure the Firebase project matches the Flutter app configuration."),(0,r.yg)("li",{parentName:"ol"},"To ensure chat notifications work properly, follow ",(0,r.yg)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=cXOzbKDXTh0"},"this video")," to\nobtain the ",(0,r.yg)("inlineCode",{parentName:"li"},"firebase.adminsdk.json")," file."),(0,r.yg)("li",{parentName:"ol"},"Replace the existing ",(0,r.yg)("inlineCode",{parentName:"li"},"firebase.adminsdk.json")," in backend with your new one.")),(0,r.yg)("h3",{id:"setting-up-agora-calls"},"Setting up Agora (calls)"),(0,r.yg)("p",null,"This guide will walk you through setting up Agora for your application, retrieving the necessary keys, and ensuring proper configuration to enable live calls."),(0,r.yg)("hr",null),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Step 1: Create and Configure Your Agora Project")),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Log in to the Agora Console")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("a",{parentName:"li",href:"https://console.agora.io/"},"Agora Console"),"."),(0,r.yg)("li",{parentName:"ul"},"Log in or create a new account if you don\u2019t have one."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Create a New Project")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Go to the ",(0,r.yg)("strong",{parentName:"li"},"Projects")," section."),(0,r.yg)("li",{parentName:"ul"},"Click ",(0,r.yg)("strong",{parentName:"li"},"Create")," to add a new project."),(0,r.yg)("li",{parentName:"ul"},"Provide a name for your project and ensure you select the ",(0,r.yg)("strong",{parentName:"li"},"Live")," mode to enable live broadcasting features."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Enable Primary Certificate")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"After creating your project, go to the ",(0,r.yg)("strong",{parentName:"li"},"Project Management")," page."),(0,r.yg)("li",{parentName:"ul"},"Locate your project and click on ",(0,r.yg)("strong",{parentName:"li"},"Edit"),"."),(0,r.yg)("li",{parentName:"ul"},"Ensure that the ",(0,r.yg)("strong",{parentName:"li"},"Primary Certificate")," is enabled. This is essential for secure communication and authentication.")))),(0,r.yg)("hr",null),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Step 2: Retrieve Your Agora Keys")),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Locate Your Project Keys")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"In the Agora Console, navigate to the ",(0,r.yg)("strong",{parentName:"li"},"Project Details")," section of your newly created project."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Get the ",(0,r.yg)("inlineCode",{parentName:"strong"},"AGORA_APP_ID"))),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Copy the ",(0,r.yg)("inlineCode",{parentName:"li"},"App ID")," value. This is your unique project identifier."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Get the ",(0,r.yg)("inlineCode",{parentName:"strong"},"AGORA_APP_CERTIFICATE"))),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Scroll down to find the ",(0,r.yg)("strong",{parentName:"li"},"Primary Certificate")," section."),(0,r.yg)("li",{parentName:"ul"},"Copy the value under ",(0,r.yg)("strong",{parentName:"li"},"Primary Certificate"),". This will be used for token generation and secure authentication.")))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Important Note:"),"\nEnsure you handle the ",(0,r.yg)("inlineCode",{parentName:"p"},"Primary Certificate")," securely and never expose it publicly to prevent unauthorized access to your application."),(0,r.yg)("hr",null),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Step 3: Update Your ",(0,r.yg)("inlineCode",{parentName:"li"},".env")," File")),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Open the ",(0,r.yg)("inlineCode",{parentName:"p"},".env")," file in your project\u2019s root directory.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Add or update the following keys with the values you retrieved from the Agora Console:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-env"},"AGORA_APP_ID=your_agora_app_id_here\nAGORA_APP_CERTIFICATE=your_agora_certificate_here\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Ensure the values match exactly with those from the Agora Console. Any mismatch will prevent calls from working correctly."))),(0,r.yg)("hr",null),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Step 4: Ensure Consistency in Your Flutter App\nIf you are using Flutter for the frontend,\ninside the flutter ",(0,r.yg)("inlineCode",{parentName:"li"},"s_constants")," file the value of ",(0,r.yg)("inlineCode",{parentName:"li"},"agoraAppId"))),(0,r.yg)("h3",{id:"obtaining-onesignal-keys"},"Obtaining OneSignal keys"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Create a Firebase account and follow ",(0,r.yg)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=FOkgfsTwvC4"},"this video")," to obtain OneSignal\nkeys.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Update the following fields with your OneSignal keys:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},'oneSignalAppId="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxx"\noneSignalApiKey="xxxxxxxxxxxx"\n')))),(0,r.yg)("h3",{id:"running-the-code-without-docker"},"Running the code (without Docker)"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"You should be familiar with ubuntu server setup")),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Install Ubuntu Server 22.04+ or 24.04"),(0,r.yg)("li",{parentName:"ol"},"Open a terminal in the ",(0,r.yg)("inlineCode",{parentName:"li"},"backend")," root folder."),(0,r.yg)("li",{parentName:"ol"},"Run ",(0,r.yg)("inlineCode",{parentName:"li"},"npm ci")," (or ",(0,r.yg)("inlineCode",{parentName:"li"},"npm i --force")," if needed)."),(0,r.yg)("li",{parentName:"ol"},"Generate a ",(0,r.yg)("inlineCode",{parentName:"li"},"dist")," folder ",(0,r.yg)("inlineCode",{parentName:"li"},"npm run build"),"."),(0,r.yg)("li",{parentName:"ol"},"Run ",(0,r.yg)("inlineCode",{parentName:"li"},"npm run start:prod")," to verify logs locally."),(0,r.yg)("li",{parentName:"ol"},"For background serving in production, use PM2:\n",(0,r.yg)("inlineCode",{parentName:"li"},"pm2 start ecosystem.config.js --only normal --env production")," and view logs via ",(0,r.yg)("inlineCode",{parentName:"li"},"pm2 logs"),"."),(0,r.yg)("li",{parentName:"ol"},"If you see ",(0,r.yg)("inlineCode",{parentName:"li"},"app run in production,")," your code is production-ready."),(0,r.yg)("li",{parentName:"ol"},"Expose port via Nginx reverse proxy. See ",(0,r.yg)("a",{parentName:"li",href:"/super_up_docs/docs/deployment"},"Deployment")," for Nginx config with WebSocket support."),(0,r.yg)("li",{parentName:"ol"},"If using Docker, ensure ",(0,r.yg)("inlineCode",{parentName:"li"},"PORT")," and env are injected properly."),(0,r.yg)("li",{parentName:"ol"},"For Nginx, include WebSocket headers in your server block:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},' proxy_set_header Upgrade $http_upgrade;\n proxy_set_header Connection "upgrade";\n proxy_http_version 1.1;\n proxy_set_header Host $host;\n proxy_set_header X-Real-IP $remote_addr;\n proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n proxy_set_header X-Forwarded-Proto $scheme;\n')),(0,r.yg)("h3",{id:"deploy-web"},"Deploy web"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"run the flutter code to build the web version inside the ",(0,r.yg)("inlineCode",{parentName:"li"},"super_up_app")," folder"),(0,r.yg)("li",{parentName:"ol"},"run this code ",(0,r.yg)("inlineCode",{parentName:"li"},"flutter build web --web-renderer html")),(0,r.yg)("li",{parentName:"ol"},"now you can find the html folder inside the build folder you need to upload it to your server"),(0,r.yg)("li",{parentName:"ol"},"Host the output on your VPS via Nginx. See ",(0,r.yg)("a",{parentName:"li",href:"/super_up_docs/docs/deployment"},"Deployment"),".")),(0,r.yg)("h3",{id:"deploy-admin"},"Deploy admin"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"run the flutter code to build the web version inside the ",(0,r.yg)("inlineCode",{parentName:"li"},"super_up_admin")," folder"),(0,r.yg)("li",{parentName:"ol"},"run this code ",(0,r.yg)("inlineCode",{parentName:"li"},"flutter build web --web-renderer html")),(0,r.yg)("li",{parentName:"ol"},"now you can find the html folder inside the build folder you need to upload it to your server"),(0,r.yg)("li",{parentName:"ol"},"Host the output on your VPS via Nginx. See ",(0,r.yg)("a",{parentName:"li",href:"/super_up_docs/docs/deployment"},"Deployment"),".")),(0,r.yg)("h3",{id:"running-the-code-with-docker"},"Running the code (with Docker)"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Install ",(0,r.yg)("a",{parentName:"li",href:"https://www.docker.com"},"Docker")," and Docker Compose."),(0,r.yg)("li",{parentName:"ol"},"Update ",(0,r.yg)("inlineCode",{parentName:"li"},".env.production")," ",(0,r.yg)("inlineCode",{parentName:"li"},"DB_URL")," to ",(0,r.yg)("inlineCode",{parentName:"li"},"mongodb://myuser_xxx:mypassword_xxx@mongo:27017/super_up?authSource=admin")," for compose."),(0,r.yg)("li",{parentName:"ol"},"Build the backend Dockerfile. Note: it only builds the backend service; MongoDB runs as a separate container, managed by compose.\ndoesn't include MongoDB or Redis. You need to manage these separately OR."),(0,r.yg)("li",{parentName:"ol"},"Use a ",(0,r.yg)("inlineCode",{parentName:"li"},"compose file")," witch manage all dependency together."),(0,r.yg)("li",{parentName:"ol"},"Run ",(0,r.yg)("inlineCode",{parentName:"li"},"docker-compose up")," to start the containers and view logs, or run ",(0,r.yg)("inlineCode",{parentName:"li"},"docker-compose up -d")," to run in the\nbackground.")),(0,r.yg)("h3",{id:"running-the-code-with-pm2"},"Running the code (with PM2)"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page"},"pm2")," is a popular framework for run the nodejs applications in background with high performance"),(0,r.yg)("li",{parentName:"ul"},"You need first to install it by ",(0,r.yg)("inlineCode",{parentName:"li"},"npm install pm2@latest -g")),(0,r.yg)("li",{parentName:"ul"},"You run the app is already ready to run with pm2 by run ",(0,r.yg)("inlineCode",{parentName:"li"},"npm run pm2")),(0,r.yg)("li",{parentName:"ul"},"To see the logs in real time you can run ",(0,r.yg)("inlineCode",{parentName:"li"},"pm2 logs"))),(0,r.yg)("h3",{id:"authkeyp8"},"AuthKey.p8"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"This key is required to make calls for ios VOIP ring you need to get it from ",(0,r.yg)("a",{parentName:"li",href:"/super_up_docs/docs/flutter#notifications-ios-apns-and-voip"},"apple"))),(0,r.yg)("h3",{id:"common-errors"},"Common errors"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If you encounter the error ",(0,r.yg)("inlineCode",{parentName:"p"},'ERROR [ExceptionHandler] Configuration key "JWT_SECRET" does not exist'),", it means NestJS\ncannot read your ",(0,r.yg)("inlineCode",{parentName:"p"},".env.production")," file."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"To fix this, ensure you have injected the environment variable or that ",(0,r.yg)("inlineCode",{parentName:"li"},".env.production")," exists in the root of the\nproject. It may be ignored by .git."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Error ",(0,r.yg)("inlineCode",{parentName:"p"},"The default Firebase app does not exist..."),": you enabled FCM but did not configure admin or Flutter side properly. Follow the linked video."))),(0,r.yg)("admonition",{title:"Contact me",type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"I offer paid full server-side setup. See ",(0,r.yg)("a",{parentName:"p",href:"/super_up_docs/docs/support"},"Plans"))))}d.isMDXComponent=!0},8860:(e,n,a)=>{a.d(n,{xA:()=>g,yg:()=>s});var t=a(7953);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach(function(n){r(e,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))})}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=t.createContext({}),y=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},g=function(e){var n=y(e.components);return t.createElement(p.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef(function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),u=y(a),m=r,s=u["".concat(p,".").concat(m)]||u[m]||d[m]||o;return a?t.createElement(s,i(i({ref:n},g),{},{components:a})):t.createElement(s,i({ref:n},g))});function s(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[u]="string"==typeof e?e:r,i[1]=l;for(var y=2;y<o;y++)i[y]=a[y];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);